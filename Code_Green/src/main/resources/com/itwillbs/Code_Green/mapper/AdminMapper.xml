<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.Code_Green.mapper.AdminMapper">


	<!-- 로그인 -->
	<select id="loginAdmin" resultType="com.itwillbs.Code_Green.vo.AdminVO">
		SELECT * FROM admin
		WHERE ADMIN_ID=#{admin_id} AND ADMIN_PASS=#{admin_pass}
	</select>

<!-- 아래부터 페이지 기능 -->


	<!-- 전체 회원 목록 갯수 조회(검색 기능 추가) -->
	<select id="selectMemberListCount" resultType="integer">
		SELECT 
			COUNT(*) 
			FROM member
			<!-- choose, when, otherwise 태그를 사용하여 복수개의 조건 판별(if ~ else if 문 구조) -->
			<!-- 1. 검색어(keyword)가 널스트링이 아닐 때 검색 수행 -->
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('id')">
						WHERE member_id LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('name')">
						WHERE member_name LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('email')">
						WHERE member_email LIKE '%${keyword}%'
					</when>
				</choose>
			</if>

	</select>



	<!-- 전체 회원 목록 조회 -->
	<select id="selectMemberList" resultType="com.itwillbs.Code_Green.vo.MemberVO">
		SELECT * FROM member
		WHERE member_del_yn='N'
		<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('id')">
						AND member_id LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('name')">
						AND member_name LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('email')">
						AND member_email LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
		ORDER BY member_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>

	

	
	<!--회원 상세 정보 조회 -->
	<select id="selectMemberInfo" resultType="com.itwillbs.Code_Green.vo.MemberVO">
		SELECT * FROM member
		WHERE 
			MEMBER_ID=#{member_id}
	</select>
	
	<!--회원 정보 수정 -->
	<update id="updateMemberInfo">
		UPDATE member
		SET 
			member_name = #{newName}
		WHERE 
			member_id = #{id}
	</update>

	<!--회원 삭제 (11.12 이전 구문)-->
<!-- 	<delete id="deleteMember"> -->
<!-- 		DELETE FROM member -->
<!-- 		WHERE -->
<!-- 			member_id = #{id} -->
<!-- 	</delete> -->
	
	<!--회원 삭제(영구삭제X) 탈퇴로 간주해 로그인X, 가입시 중복아이디로 가입불가능-->
	<update id="deleteMember">
		UPDATE member
		SET
			member_del_yn = 'Y'
		WHERE
			member_id = #{id}
	</update>




<!-- 기업체 관리역에 도착했습니다. 기업체 관리역에 도착했습니다. 기업체 관리역에 도착했습니다. 기업체 관리역에 도착했습니다-->



	<!-- 기업체 목록 갯수 조회( 승인완료 | 검색기능 추가) -->
	<select id="selectManagerListCount" resultType="integer">
		SELECT 
			COUNT(*) 
		FROM
			manager
		WHERE
			manager_adminauth='Y' AND manager_del_yn='N'
			<!-- choose, when, otherwise 태그를 사용하여 복수개의 조건 판별(if ~ else if 문 구조) -->
			<!-- 1. 검색어(keyword)가 널스트링이 아닐 때 검색 수행 -->
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('brandName')">
						AND manager_brandname LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('name')">
						AND manager_name LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('id')">
						AND member_id LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
	</select>



	<!--기업체 목록 조회(승인완료) -->
	<select id="selectManagerList" resultType="com.itwillbs.Code_Green.vo.ManagerVO">
		SELECT * 
		FROM
			manager
		WHERE
			manager_adminauth='Y' AND manager_del_yn ='N'
		<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('brandName')">
					AND manager_brandname LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('name')">
					AND manager_name LIKE '%${keyword}%' 
				</when>
				<when test="searchType.equals('id')">
					AND manager_id LIKE '%${keyword}%'
				</when>
			</choose>
		</if>
		ORDER BY manager_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	
	
	<!-- 기업체 목록 갯수 조회( 미승인 | 검색기능 추가) -->
	<select id="selectAuthListCount" resultType="integer">
		SELECT 
			COUNT(*) 
		FROM
			manager
		WHERE
			manager_adminauth='N' AND manager_del_yn='N'
			<!-- choose, when, otherwise 태그를 사용하여 복수개의 조건 판별(if ~ else if 문 구조) -->
			<!-- 1. 검색어(keyword)가 널스트링이 아닐 때 검색 수행 -->
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('brandName')">
						AND manager_brandname LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('name')">
						AND manager_name LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('id')">
						AND member_id LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
	</select>
	
	
	
	<!--기업체 목록 조회(미승인) -->
	<select id="selectManagerAuthList" resultType="com.itwillbs.Code_Green.vo.ManagerVO">
		SELECT * FROM manager
		WHERE
			manager_adminauth='N' AND manager_del_yn ='N'
		<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('brandName')">
					AND manager_brandname LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('name')">
					AND manager_name LIKE '%${keyword}%' 
				</when>
				<when test="searchType.equals('id')">
					AND manager_id LIKE '%${keyword}%'
				</when>
			</choose>
		</if>
		ORDER BY manager_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>


	

	<!--기업 상세 정보 조회 -->
	<select id="selectManagerInfo" resultType="com.itwillbs.Code_Green.vo.ManagerVO">
		SELECT * FROM manager
		WHERE
			manager_id = #{manager_id } 
	</select>

	<!--기업 삭제 (11.13 이전 구문) -->
<!-- 	<delete id="deleteManager"> -->
<!-- 		DELETE FROM manager -->
<!-- 		WHERE  -->
<!-- 			manager_id =#{manager_id} -->
<!-- 	</delete> -->

	<!--기업 삭제(영구삭제X) -->
	<update id="deleteManager">
		UPDATE manager
		SET
			manager_del_yn = 'Y'
		WHERE
			manager_id =#{manager_id}
	</update>




<!-- 1:1 문의글 관리역에 도착했습니다. 1:1 문의글 관리역에 도착했습니다. 1:1 문의글 관리역에 도착했습니다. 1:1 문의글 관리역에 도착했습니다-->


	<!--1:1 문의글 갯수 조회 -->
	<select id="selectOneListCount" resultType="integer">
		SELECT COUNT(*)
		FROM qna
		WHERE
			qna_type='1:1문의'
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('category1')">
						AND qna_category='배송문의' AND qna_subject LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('category2')">
						AND qna_category='주문/결제/반품/교환문의' AND qna_subject LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('category3')">
						AND qna_category='상품누락문의' AND qna_subject LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('category4')">
						AND qna_category='기타문의' AND qna_subject LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
	</select>


	<!--1:1 문의글 목록 조회 -->
	<select id="selectOneQnaList" resultType="com.itwillbs.Code_Green.vo.QnaVO">
		SELECT * FROM qna
		WHERE
			qna_type='1:1문의'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('category1')">
					AND qna_category='배송문의' AND qna_subject LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('category2')">
					AND qna_category='주문/결제/반품/교환문의' AND qna_subject LIKE '%${keyword}%' 
				</when>
				<when test="searchType.equals('category3')">
					AND qna_category='상품 누락 문의' AND qna_subject LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('category4')">
					AND qna_category='이벤트/쿠폰/적립금문의' AND qna_subject LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('category5')">
					AND qna_category='기타 문의' AND qna_subject LIKE '%${keyword}%'
				</when>
			</choose>
		</if>
		ORDER BY 
				qna_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>

	<!--1:1 문의글 상세 조회 -->
	<select id="selectOneQnaInFo" resultType="com.itwillbs.Code_Green.vo.QnaVO">
		SELECT * FROM qna
		WHERE 
			qna_id=#{id} AND qna_subject=#{subject}
	</select>

	<!--1:1 문의글 삭제 -->
	<delete id="deleteOneQnaBoard">
		DELETE FROM qna
		WHERE 
			qna_id =#{id}
	</delete>
	
	<!--상품문의글(답변대기) 갯수 조회 -->
	<select id="selectItemQnaListCount" resultType="Integer">
		SELECT COUNT(*)
		FROM qna 
		WHERE
			qna_type='상품문의' AND qna_category='답변대기'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND qna_id LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('subject')">
					AND qna_subject LIKE '%${keyword}%' 
				</when>
			</choose>
		</if>
	</select>
	
	
	<!--상품문의(답변대기) 목록 조회 -->
	<select id="selectItemQnaList" resultType="com.itwillbs.Code_Green.vo.QnaVO">
		SELECT * 
		FROM qna q JOIN item i
		ON q.qna_item_idx = i.item_idx
		WHERE
			q.qna_type='상품문의' AND q.qna_category='답변대기'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND qna_id LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('subject')">
					AND qna_subject LIKE '%${keyword}%' 
				</when>
			</choose>
		</if>
		ORDER BY 
				q.qna_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	
	<!--상품문의글 상세 조회 -->
	
	
	
	<select id="selectItemAnswerListCount" resultType="Integer">
		SELECT COUNT(*)
		FROM qna 
		WHERE
			qna_type='상품문의' AND qna_category='답변완료'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND qna_id LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('subject')">
					AND qna_subject LIKE '%${keyword}%' 
				</when>
			</choose>
		</if>
	</select>
	
	
	
	
	<!--상품문의(답변완료) 목록 조회 -->
	<select id="selectItemAnswerList" resultType="com.itwillbs.Code_Green.vo.QnaVO">
		SELECT * 
		FROM qna q JOIN item i
		ON q.qna_item_idx = i.item_idx
		WHERE
			q.qna_type='상품문의' AND q.qna_category='답변완료'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND qna_id LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('subject')">
					AND qna_subject LIKE '%${keyword}%' 
				</when>
			</choose>
		</if>
		ORDER BY 
				q.qna_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
<!-- 게시판 관리역에 도착했습니다. 게시판 관리역에 도착했습니다. 게시판 관리역에 도착했습니다. 게시판 관리역에 도착했습니다-->
	
	
	
	
	<!-- 커뮤니티 게시글 목록 -->
	<select id="selectBoardList" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		SELECT * FROM board
			WHERE 
				board_type='커뮤'
			ORDER BY 
				board_idx DESC
	</select>
	
	<!-- 후기 게시글 갯수  -->
	<select id="selectReviewListCount" resultType="Integer">
		SELECT 
			COUNT(*) 
		FROM
			board
		WHERE
			board_type='후기'
			<!-- choose, when, otherwise 태그를 사용하여 복수개의 조건 판별(if ~ else if 문 구조) -->
			<!-- 1. 검색어(keyword)가 널스트링이 아닐 때 검색 수행 -->
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('subject')">
						AND board_subject LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('content')">
						AND board_content LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('id')">
						AND board_id LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
	</select>
	
	<!-- 후기 게시글 목록 -->
	<select id="selectReviewList" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		SELECT * FROM board
		WHERE 
			board_type='후기'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('subject')">
					AND board_subject LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('content')">
					AND board_content LIKE '%${keyword}%' 
				</when>
				<when test="searchType.equals('id')">
					AND board_id LIKE '%${keyword}%'
				</when>
			</choose>
			</if>
		ORDER BY 
			board_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	
	<!-- 게시글 삭제 -->
	<delete id="deleteBoard">
		DELETE FROM board
		WHERE
			board_idx=#{board_idx }
	</delete>
	
	
<!-- 신고글 관리역에 도착했습니다. 신고글 관리역에 도착했습니다. 신고글 관리역에 도착했습니다. 신고글 관리역에 도착했습니다-->
	
	
	<!-- 신고글(처리대기) 갯수 조회 -->
	<select id="selectReportListCount" resultType="Integer">
		SELECT COUNT(*) 
		FROM report
		WHERE 
			report_status='처리대기'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND reporter LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('content')">
					AND report_content LIKE '%${keyword}%' 
				</when>
			</choose>
			</if>
		ORDER BY 
			report_idx DESC
	</select>
	
	
	<!-- 신고글 목록(처리대기) -->
	<select id="selectReportList" resultType="com.itwillbs.Code_Green.vo.ReportVO">
		SELECT * FROM report
		WHERE 
			report_status='처리대기'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND reporter LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('content')">
					AND report_content LIKE '%${keyword}%' 
				</when>
			</choose>
			</if>
		ORDER BY 
			report_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	
	<!-- 신고글(처리완료) 갯수 조회 -->
	<select id="selectReportSuccessListCount" resultType="Integer">
		SELECT COUNT(*) 
		FROM report
		WHERE 
			report_status='처리완료'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND reporter LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('content')">
					AND report_content LIKE '%${keyword}%' 
				</when>
			</choose>
			</if>
		ORDER BY 
			report_idx DESC
	</select>
	
	
	<!-- 신고글 목록(처리완료) -->	
	<select id="selectReportSuccessList" resultType="com.itwillbs.Code_Green.vo.ReportVO">
		SELECT * FROM report
		WHERE
			report_status='처리완료'
			<if test="!keyword.equals('')">
			<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
			<choose>
				<when test="searchType.equals('id')">
					AND reporter LIKE '%${keyword}%'
				</when>
				<when test="searchType.equals('content')">
					AND report_content LIKE '%${keyword}%' 
				</when>
			</choose>
			</if>
		ORDER BY 
			report_idx DESC
		LIMIT #{startRow}, #{listLimit}
	</select>
	
	
	<!-- 신고글 상세조회 -->
	<select id="selectReportInfo" resultType="com.itwillbs.Code_Green.vo.ReportVO">
		SELECT * FROM report
		WHERE
			report_idx=#{report_idx}
	</select>
	
	
	<!-- 신고된 원본글 조회! -->
	<select id="selectOriginBoard" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		SELECT 
			*
		from 
			board b JOIN report r
		ON 
			b.board_idx = r.board_idx 
		where
			r.report_idx=#{report_idx}
	</select>
	
	
	<!-- 신고글 삭제 -->
	<delete id="deleteReport">
		DELETE FROM report
		WHERE
			report_idx=#{report_idx}
	</delete>
	
	
	<!-- 신고글 상태처리 -->
<!-- 	<update id="updateReportStatus"> -->
<!-- 		UPDATE  -->
<!-- 			report -->
<!-- 		SET -->
<!-- 			report_status = '처리완료' -->
<!-- 		WHERE -->
<!-- 			report_idx=#{report_idx} -->
<!-- 	</update> -->
	<!-- 신고글 상태처리 -->
	<update id="updateReportStatus">
		UPDATE 
			report
		SET
			report_status = '처리완료'
		WHERE
			board_idx=#{board_idx}
	</update>
	

</mapper>
