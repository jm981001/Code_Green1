<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwillbs.Code_Green.mapper.RecipeMapper">
	
	<!-- 레시피 등록(글) -->
	<insert id="insertRecipeBoard">
		INSERT 
			  INTO board 
			            VALUES (
								IFNULL((SELECT MAX(board_idx) FROM board b),0) + 1,
								'0',
								'레시피',
								#{board_id},
								'N',
								#{board_subject},
								#{board_content},
								'0',
								date_format(now(),'%Y%m%d')
								)
	</insert>	
	
	<!-- 레시피 등록(사진) -->
	<insert id="insertRecipeFile">
		<selectKey keyProperty="file_board_idx" resultType="integer" order="BEFORE">
		SELECT MAX(file_board_idx) 
		  FROM file_board
		</selectKey>
		INSERT
			  INTO file_board
							 VALUES (
									#{file_board_idx} + 1,
									IFNULL(#{file1},'N'),
									IFNULL(#{file2},'N'),
									'', 
									(SELECT MAX(board_idx) FROM board)
								    )
	</insert>
	
	<!-- 레시피 목록(글) 조회 -->
	<select id="selectRecipeFile" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		SELECT
			   b.board_subject,	   
			   f.file1,
			   m.manager_brandname
		  FROM board b
     LEFT JOIN file_board f
     	    ON b.board_idx = f.rf_board_idx
		  JOIN manager m 
		    ON b.board_id = m.manager_id
		 WHERE b.board_type = '레시피'
		<if test="!keyword.equals('')">                         
		<choose>                                            
			<when test="searchType.equals('recipe_name')">     
		   AND b.board_subject LIKE '%${keyword}%'            
			</when>                                        
			<when test="searchType.equals('recipe_brandname')">     
		   AND m.manager_brandname LIKE '%${keyword}%'  
			</when>                                          
		</choose>                                            
	  </if>
	</select>
</mapper>