<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.Code_Green.mapper.ReviewMapper">

	
<!-- 	리뷰 등록 -->
	<insert id="insertReview">
		<selectKey keyProperty="board_idx" resultType="integer" order="BEFORE">
			SELECT MAX(board_idx) FROM board
		</selectKey>
		INSERT 
			INTO board
			VALUES (
					#{board_idx}+ 1,   
					#{item_idx}, 
					"후기", 
					#{board_id}, 
					"N", 
					#{board_subject}, 
					#{board_content}, 
					"0", 
					date_format(now(),'%Y%m%d'),
					"0"
					)
	</insert>
	
<!-- 	리뷰 파일업로드 -->
	<insert id="insertFile">
		<selectKey keyProperty="file_board_idx" resultType="integer" order="BEFORE">
			SELECT MAX(file_board_idx) FROM file_board
		</selectKey>
		INSERT 
			INTO file_board
			VALUES (
					#{file_board_idx} + 1, 
					#{file1}, 
					#{file2}, 
					"N", 
 					(SELECT MAX(board_idx) FROM board)
					)
	</insert>
	
	
	<!-- 별점 등록 -->
	<insert id="insertStar">
		<selectKey keyProperty="board_star_idx" resultType="integer" order="BEFORE">
			SELECT MAX(board_star_idx) FROM board_star
		</selectKey>
		INSERT 
			INTO board_star
			VALUES (
					#{board_star_idx} + 1, 
					(SELECT MAX(board_idx) FROM board), 
					#{board_star_score}
					)
	</insert>
		
	
	
<!-- 	리뷰삭제 -->
	<delete id="deleteReview">
		DELETE
			FROM board
			WHERE 
				board_idx = #{board_idx}
	</delete>
	
	
		<!-- 마이페이지 작성글 목록-->
	<select id="selectBoardList" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		 SELECT *
		 FROM board
		 WHERE board_id = #{member_id} and board_type NOT LIKE '%후기%'
		 ORDER BY board_idx DESC
		 LIMIT #{startRow}, #{listLimit}
	</select>
	
	
		<!-- 마이페이지 작성글 갯수 -->
	<select id="selectItemListCount" resultType="integer">
		SELECT 
			COUNT(*) 
			FROM board
			 WHERE board_id = #{member_id} and board_type NOT LIKE '%후기%'
	</select>
	
	

	
	
	
</mapper>
