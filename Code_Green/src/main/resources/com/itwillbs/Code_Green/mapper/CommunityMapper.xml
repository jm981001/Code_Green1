<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.Code_Green.mapper.CommunityMapper">



	<!-- 게시물 목록 조회(검색 기능 추가) -->
	<select id="selectCommunityList" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		SELECT * 
			FROM board WHERE board_type = '커뮤'
			<!-- choose, when, otherwise 태그를 사용하여 복수개의 조건 판별(if ~ else if 문 구조) -->
			<!-- 1. 검색어(keyword)가 널스트링이 아닐 때 검색 수행 -->
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('category')">
						AND board_category LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('id')">
						AND board_id LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('subject')">
						AND board_subject LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('content')">
						AND board_content LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('subject_content')">
						AND board_subject LIKE '%${keyword}%' OR board_content LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
			ORDER BY
				board_idx DESC
			LIMIT #{startRow}, #{listLimit}
	</select>




	<!-- 전체 게시물 목록 갯수 조회(검색 기능 추가) -->
	<select id="selectCommunityListCount" resultType="integer">
		SELECT 
			COUNT(*) 
			FROM board WHERE board_type = '커뮤'
			<!-- choose, when, otherwise 태그를 사용하여 복수개의 조건 판별(if ~ else if 문 구조) -->
			<!-- 1. 검색어(keyword)가 널스트링이 아닐 때 검색 수행 -->
			<if test="!keyword.equals('')">
				<!-- 2. 검색타입(search)에 따른 WHERE 변경 -->
				<choose>
					<when test="searchType.equals('category')">
						AND board_category LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('id')">
						AND board_id LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('subject')">
						AND board_subject LIKE '%${keyword}%'
					</when>
					<when test="searchType.equals('content')">
						AND board_content LIKE '%${keyword}%' 
					</when>
					<when test="searchType.equals('subject_content')">
						AND board_subject LIKE '%${keyword}%' OR board_content LIKE '%${keyword}%'
					</when>
				</choose>
			</if>
	</select>
		
		
	<!-- 게시물 조회수 증가 -->
	<update id="updateReadcount">
		UPDATE board
			SET 
				board_readcount = board_readcount + 1
			WHERE
				board_idx = #{board_idx}
	</update>
		
		
		
		
	<!-- 글 상세정보 조회 -->
	<select id="selectBoardDetail" resultType="com.itwillbs.Code_Green.vo.BoardVO">
		SELECT * 
			FROM board
			WHERE board_type = '커뮤' AND board_idx = #{board_idx}
	</select>	
		
		
		
		
	<!-- 글 삭제  -->
	<delete id="deleteBoard">
		DELETE 
			FROM board
			WHERE 
				board_type = '커뮤' 
				AND 
				board_idx = #{board_idx}
	</delete>
		
		
		
		
		
	<!-- 신고글 입력 -->	
	<insert id="insertReport">
		INSERT 
			INTO report
			VALUES (
					IFNULL((SELECT MAX(report_idx) FROM report r),0) + 1,   
					#{board_idx}, 
					#{report_subject}, 
					#{report_content}, 
					#{reporter}, 
					'처리대기', 				
					date_format(now(),'%Y%m%d%T'))
					
	</insert>
	
	
	
</mapper>
